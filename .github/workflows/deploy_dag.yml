name: Deploy to Google Cloud

on: [push]

jobs:
  job_id:
    permissions:
      contents: 'read'
      id-token: 'write'

    runs-on: ubuntu-latest
    
    steps:
    - id: 'checkout'
      uses: 'actions/checkout@v4'

      id: 'auth'
      uses: 'google-github-actions/auth@v2'
      with:
      # this is the base64 version of the key json file of the service account
      # cat sa.json | tr -d '\n' | base64 | pbcopy
      credentials_json: ${{ secrets.CAPSTONE_SERVICE_ACCOUNT_BASE64 }}
    
    - id: 'upload-dags-to-gcs'
      uses: 'google-github-actions/upload-cloud-storage@v2'
      with:
      path: 'dags'
      # check if this environment variable in Github Actions UI
      destination: "${{ vars.DAGS_BUCKET}}/dags"
      parent: false
